version: '3.9'

services:
  mysql:
    image: mysql:latest
    environment:
      MYSQL_DATABASE: wp
      MYSQL_USER: wp
      MYSQL_PASSWORD: secret
      MYSQL_ROOT_PASSWORD: secret
    volumes:
      - mariadb:/var/lib/mysql

  nginx:
    build:
      context: requirements/nginx
      dockerfile: Dockerfile
    ports:
    #  - 80:80
      - 443:443
    volumes:
      - ./requirements/wordpress/wordpress:/var/www/html:delegated
    depends_on:
      - php
      - mysql
    env_file: 
      - .env
    restart: always

  php:
    image: php:7.4-fpm-alpine
    volumes:
      - ./requirements/wordpress/wordpress:/var/www/html:delegated

  # php:
  #   build:
  #     context: requirements/wordpress
  #     dockerfile: Dockerfile
  #   volumes:
  #     - ./requirements/wordpress/wordpress:/var/www/html:delegated
  # wp:
  #   build:
  #     context: requirements/wordpress
  #     dockerfile: Dockerfile
  #   volumes:
  #     - ./requirements/wordpress/wordpress:/var/www/html:delegated
  #   entrypoint: ['wp', '--allow-root']

volumes:
  # wordpress:
  #   driver: local
  #   driver_opts:
  #     type: 'none'
  #     o: 'bind'
  #     device: /home/vhappenh/data/wordpress
  
  mariadb:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: /home/vhappenh/data/mariadb

# networks:
#   inception:
#     driver: bridge